import{j as e,r as t,A as H,n as u,y as I}from"./index-n5AiC0OA.js";import{V as L,H as V,P as $,F as q}from"./PageContent-2U22pPkP.js";import{g as B,a as S,b as D}from"./Users-Dnk3imjk.js";import{A as M,c as T,d as Z}from"./APIUsers-DmPOgH-d.js";import"./index-CmqmJUPe.js";const G=({user:s})=>e.jsx("div",{className:"relative overflow-hidden bg-white shadow-md dark:bg-gray-800 sm:rounded-lg",children:e.jsx("div",{className:"flex-row items-center justify-between p-4 space-y-3 sm:flex sm:space-y-0 sm:space-x-4",children:e.jsx("div",{children:e.jsxs("h2",{className:"text-3xl",children:["Edit User ",s==null?void 0:s.user_nicename]})})})}),x=({type:s,title:a,name:o,value:d,updateFunction:i})=>e.jsxs("div",{className:"w-full my-4",children:[e.jsx("label",{children:a}),e.jsx("input",{type:s,name:o,placeholder:a,autoComplete:a,value:d,className:"bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5",required:!0,onChange:r=>{i(r.target.value)}})]}),W=({title:s,name:a,value:o,updateFunction:d,options:i})=>e.jsxs("div",{className:"my-4 w-full",children:[e.jsx("label",{children:s}),e.jsxs("select",{id:a,className:"block w-auto bg-gray-100 border-gray-300 border px-4 py-2 divide-y divide-gray-100 rounded shadow w-44 dark:bg-gray-700 dark:divide-gray-600",value:o,onChange:r=>d(r.target.value),children:[e.jsx("option",{value:"",children:s}),i.map(r=>e.jsx("option",{value:r.id,onChange:l=>d(l.target.value),children:r.role.replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase())},r.id))]})]}),z=({password:s,setPassword:a,setShowPassword:o,hide:d,setHide:i,getPasswordStrength:r})=>{const[l,m]=t.useState(0);return t.useEffect(()=>{m(r(s))},[s]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full flex flex-row items-center",children:[e.jsx("input",{type:d?"password":"text",name:"password",id:"password",placeholder:"Password",autoComplete:"Current Password",value:s,className:"bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5",required:"",onChange:c=>{a(c.target.value)}}),e.jsx("button",{type:"button",className:"ml-4 secondary-btn",onClick:()=>i(c=>!c),children:d?"Show":"Hide"}),e.jsx("button",{type:"button",className:"ml-4 secondary-btn",onClick:()=>o(!1),children:"Cancel"})]}),e.jsxs("div",{className:`mt-1 ${l.bg} px-4 py-2`,children:[e.jsx("div",{className:"w-full bg-gray-200 rounded h-2",children:e.jsx("div",{className:`h-2 rounded ${l.color} ${l.width}`,style:{transition:"width 0.3s ease"}})}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:l.label})]})]})},J=({id:s})=>{const{loginPassword:a}=t.useContext(H),[o,d]=t.useState(null),[i,r]=t.useState(!1),[l,m]=t.useState(""),[c,f]=t.useState(""),[h,p]=t.useState(""),[b,y]=t.useState(""),[j,v]=t.useState(0),[k,R]=t.useState([]),[g,U]=t.useState(B()),[w,N]=t.useState(!1),[F,E]=t.useState(!1),_=async()=>{if(w&&S(g).label=="Weak"){u("Cannot save a weak password, please amend and try again.","error");return}if((await Z(a,h,l,c,b,w?g:null,j,o==null?void 0:o.id)).status==200){u("Successfully updated user.","success");return}u("Failed to update user.","error")},A=async()=>{const n=await T(a,s);n.status==200?n.data.passwordResetAdmin.success?u("Password reset email sent to client","success"):u("Password reset email failed to send to client","error"):u("Password reset email failed to send to client","error")},P=async()=>{const n=await D("id",s);n!=null&&(d(n),p(n.user_nicename),m(n.first_name),f(n.last_name),y(n.user_email),v(n.user_role.id));const C=await M(a);C.status==200&&R(C.data.getUserRoles.roles)};return t.useEffect(()=>{P()},[]),t.useEffect(()=>{i==!0&&(r(!1),P())},[i]),e.jsx("div",{className:"w-full flex flex-col md:flex-row",children:e.jsxs("div",{className:"w-full",children:[e.jsx(G,{user:o}),e.jsxs("div",{className:"relative overflow-x-auto shadow-md sm:rounded-lg bg-white w-full mt-8 p-4",children:[e.jsx(x,{type:"text",name:"nicename",title:"Nice Name",value:h,updateFunction:p}),e.jsx(x,{type:"text",name:"first_name",title:"First Name",value:l,updateFunction:m}),e.jsx(x,{type:"text",name:"last_name",title:"Last Name",value:c,updateFunction:f}),e.jsx(W,{name:"role",title:"Role",value:j,updateFunction:v,options:k}),e.jsx("h1",{className:"text-xl mb-4",children:"Contact Info"}),e.jsx(x,{type:"email",name:"email",title:"Email",value:b,updateFunction:y}),e.jsx("h1",{className:"text-xl mb-4",children:"Account Management"}),e.jsxs("div",{className:"w-full my-4",children:[e.jsx("label",{children:"New Password"}),w?e.jsx(e.Fragment,{children:e.jsx(z,{password:g,setPassword:U,hide:F,setHide:E,setShowPassword:N,getPasswordStrength:S})}):e.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>N(!0),children:"Set New Password"})]}),e.jsxs("div",{className:"w-full my-4",children:[e.jsx("label",{children:"Password Reset"}),e.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>A(),children:"Send Reset Link"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Send ",h," a link to reset their password. This will not change their password, nor will it force a change."]})]}),e.jsxs("button",{type:"button",className:"flex items-center justify-center px-4 py-2 text-sm font-medium text-white rounded-lg bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-primary-300 dark:bg-primary-600 dark:hover:bg-primary-700 focus:outline-none dark:focus:ring-primary-800",onClick:()=>{_()},children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 mr-2",children:e.jsx("path",{fillRule:"evenodd",d:"M4.755 10.059a7.5 7.5 0 0 1 12.548-3.364l1.903 1.903h-3.183a.75.75 0 1 0 0 1.5h4.992a.75.75 0 0 0 .75-.75V4.356a.75.75 0 0 0-1.5 0v3.18l-1.9-1.9A9 9 0 0 0 3.306 9.67a.75.75 0 1 0 1.45.388Zm15.408 3.352a.75.75 0 0 0-.919.53 7.5 7.5 0 0 1-12.548 3.364l-1.902-1.903h3.183a.75.75 0 0 0 0-1.5H2.984a.75.75 0 0 0-.75.75v4.992a.75.75 0 0 0 1.5 0v-3.18l1.9 1.9a9 9 0 0 0 15.059-4.035.75.75 0 0 0-.53-.918Z",clipRule:"evenodd"})}),"Update"]})]})]})})},ee=()=>{document.title="Users - Edit";const{id:s}=I();return e.jsxs(L,{children:[e.jsx(V,{}),e.jsx($,{children:e.jsx(J,{id:s})}),e.jsx(q,{})]})};export{ee as default};
