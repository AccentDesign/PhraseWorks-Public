import{j as e,r as t}from"./vendor-react.js";import{A as s,U as l,l as n,m as a,o as c,n as i}from"./index.js";import{f as o,a as d}from"./vendor-utils.js";import{L as r}from"./vendor-other.js";const m=()=>e.jsx("div",{className:"title-panel",children:e.jsx("div",{className:"title-bar",children:e.jsx("h2",{className:"text-3xl",children:"Comments"})})}),h=({totalComments:t,page:s,perPage:l,setPage:n})=>e.jsxs("div",{className:"pagination-block",children:[e.jsxs("p",{className:"mr-4",children:[t," items"]}),e.jsxs("div",{className:"pagination-buttons",children:[e.jsx("button",{className:"pagination-btn "+(1==s?"pagination-btn-disabled":"pagination-btn-enabled"),onClick:()=>{s>=2&&(async()=>{n(1)})()},children:"«"}),e.jsx("button",{className:"pagination-btn "+(1==s?"pagination-btn-disabled":"pagination-btn-enabled"),onClick:()=>{s>=2&&(async()=>{n(s-1)})()},children:"‹"}),e.jsxs("p",{children:[s," of ",Math.ceil(t/l)]}),e.jsx("button",{className:"pagination-btn "+(s==Math.ceil(t/l)?"pagination-btn-disabled":"pagination-btn-enabled"),onClick:()=>{s!==Math.ceil(t/l)&&(async()=>{n(s+1)})()},children:"›"}),e.jsx("button",{className:"pagination-btn "+(s==Math.ceil(t/l)?"pagination-btn-disabled":"pagination-btn-enabled"),onClick:()=>{s!==Math.ceil(t/l)&&(async()=>{n(Math.ceil(t/l))})()},children:"»"})]})]}),x=({setFilter:t,totalComments:s,filter:l,comments:n,user:a})=>e.jsxs("div",{className:"filter-panel",children:[e.jsxs("button",{type:"button",onClick:()=>t("all"),className:"text-sm "+("all"==l?"text-black font-bold":"text-blue-800"),children:["All ",e.jsxs("span",{className:"font-normal",children:["(",n.length,")"]})]}),e.jsxs("button",{type:"button",onClick:()=>t("mine"),className:"text-sm "+("mine"==l?"text-black font-bold":"text-blue-800"),children:["Mine"," ",e.jsxs("span",{className:"font-normal",children:["(",n.filter(e=>e.user_id==a.id).length,")"]})]})]}),u=({bulkAction:t,setBulkAction:s,handleApply:l,filter:n})=>e.jsxs("div",{className:"actions-panel",children:[e.jsxs("select",{id:"actionsDropdown",className:"select",value:t,onChange:e=>s(e.target.value),children:[e.jsx("option",{value:"",children:"Bulk Actions"}),"trash"!=n?e.jsx("option",{value:"trash",children:"Trash Items"}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"delete",children:"Delete Permanently"}),e.jsx("option",{value:"restore",children:"Restore"})]})]}),e.jsxs("button",{type:"button",className:"ml-4 text-white bg-blue-700 hover:bg-blue-800 btn",onClick:l,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 mr-2 -ml-1",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M19.916 4.626a.75.75 0 0 1 .208 1.04l-9 13.5a.75.75 0 0 1-1.154.114l-6-6a.75.75 0 0 1 1.06-1.06l5.353 5.353 8.493-12.74a.75.75 0 0 1 1.04-.207Z",clipRule:"evenodd"})}),"Apply"]})]}),p=({comments:t,selectedIds:s,toggleCheckbox:l,permanentDelete:n,allSelected:a,toggleAllCheckboxes:c})=>{const i=e=>{const t=new Date(e),s=o(t,"h:mm a"),l=o(t,"do MMMM yyyy"),n=d(t,{addSuffix:!0});return`${s}, ${l}, ${m(n)}`},m=e=>e.charAt(0).toUpperCase()+e.slice(1);return e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:e.jsx("input",{type:"checkbox",checked:a,onChange:c,className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded-sm focus:ring-blue-500 focus:ring-2"})}),e.jsx("th",{scope:"col",children:"Post"}),e.jsx("th",{scope:"col",children:"Excerpt"}),e.jsx("th",{scope:"col",children:"Author"}),e.jsx("th",{scope:"col",children:"Date"})]})}),e.jsx("tbody",{children:t.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{scope:"row",className:"table-checkbox-cell",children:e.jsx("input",{id:"default-checkbox",type:"checkbox",value:t.comment_id,checked:s.includes(t.comment_id),onChange:()=>l(t.comment_id),className:"checkbox"})}),e.jsxs("td",{className:"flex flex-col",children:[e.jsx("div",{className:"flex flex-row items-center",children:e.jsx(r,{to:`/admin/posts/edit/${t.comment_post_id}`,className:"text-blue-700 font-bold",children:t.post.post_title})}),e.jsx("div",{className:"flex flex-row items-center gap-4",children:e.jsx("p",{children:e.jsx("button",{className:"link-red-xs",onClick:()=>n(t.comment_id),children:"Permanently Delete"})})})]}),e.jsxs("td",{children:[t.comment_content.slice(0,150),t.comment_content.length>150?"...":""]}),e.jsx("td",{children:t.user.display_name}),e.jsx("td",{children:i(t.comment_date)})]},a))})]})},b=()=>{const{loginPassword:o}=t.useContext(s),{user:d}=t.useContext(l),[r,b]=t.useState([]),[j,g]=t.useState([]),[f,C]=t.useState(0),[y,N]=t.useState(!1),[v,k]=t.useState("all"),[A,w]=t.useState(1),[S,M]=t.useState(20),[_,P]=t.useState(""),[B,D]=t.useState([]),I=r.length>0&&B.length===r.length,$=async(e=!0)=>{const t=await n(o,1,999999999);e&&g(t.data.getAllAdminComments.comments);const s=await n(o,A,S),l=await a(o,A,S,d.id);"all"==v?e&&200==s.status&&(b(s.data.getAllAdminComments.comments),C(s.data.getAllAdminComments.totalComments)):"mine"==v&&e&&200==l.status&&(b(l.data.getAllAdminCommentsByAuthor.comments),C(l.data.getAllAdminCommentsByAuthor.totalComments))};return t.useEffect(()=>{let e=!0;return(async()=>{await $(e)})(),()=>{e=!1}},[A,v]),t.useEffect(()=>{let e=!0;return y&&(N(!1),"all"!=v?k("all"):$(e)),()=>{e=!1}},[y]),e.jsxs("div",{className:"w-full",children:[e.jsx(m,{}),e.jsx(x,{comments:j,totalComments:f,filter:v,setFilter:k,user:d}),e.jsx(u,{bulkAction:_,setBulkAction:P,handleApply:async()=>{if("trash"===_&&B.length>0){(await Promise.all(B.map(async e=>{var t,s;const l=await c(o,e);return 200===l.status&&(null==(s=null==(t=l.data)?void 0:t.deleteCommentById)?void 0:s.success)}))).some(e=>e)&&(i("Successfully deleted comment(s)","success"),N(!0),D([]))}},filter:v}),e.jsxs("div",{className:"panel mt-8",children:[e.jsx(p,{comments:r,selectedIds:B,toggleCheckbox:e=>{D(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},permanentDelete:async e=>{const t=await c(o,e);200==t.status&&t.data.deleteCommentById.success&&(N(!0),i("Successfully deleted comment","success"))},allSelected:I,toggleAllCheckboxes:()=>{B.length===r.length?D([]):D(r.map(e=>e.id))}}),e.jsx(h,{totalComments:f,page:A,perPage:S,setPage:w})]})]})};export{b as C};
